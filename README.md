# Инстанс сегментация рентгеновских снимков позвоночника
---------------------------------------------------------
### Цель работы
- Обучение модели нейросети на распознавание позвонков человека
### Задачи
1. Найти датасеты, содержащие подходящие данные и разметку
2. Выбрать модель нейросети
3. Обучить нейросеть
4. Проанализировать работу обученной модели
5. Написать план по развитию определения остохандроза
------------------------------------------------------------
## Датасеты
Для поиска датасетов были использванны следующие ресурсы:
- [Roboflow](https://roboflow.com/)
- [Kaggle](https://www.kaggle.com/)
- [Hugging Face](https://huggingface.co/)


На Roboflow были найдены 2 датасета с подходящими данными:
- [Scoliosis Computer Vision Dataset](https://universe.roboflow.com/mimitlab/scoliosis-gnlbf)
- [Cervical Segmentation Computer Vision Dataset](https://universe.roboflow.com/sha-dw5z0/cervical-segmentation-eoxax)

Данные датасетов были расширенны `переворотами`, `поворотом на  90 градусов` и `вращением` при помощи `Augmentation Options` доступной на Roboflow.
Также на Roboflow есть возможность скачать датасеты с изменением данных(`.yaml`,`.json`,`.csv` и т.д.), необходимых для обучения, под конкретную модель, что в дальнейшем было использовано.

Далее датасеты были объеденены и конечный датасет будет использован для обучения модели.

--------------------------------------------------------

## Модель нейросети
На этапе выбора модели нейросети были выдвинуты следующие критерии:
- Точность определения
- Скорость обучения и работы
- Ресурсозатратность

Далее были рассмотренны следующие модели по критериям выше

|             **Модель**               |     **Точность**      |    **Скорость**   | **Ресурсозатратность** |
| :----------------------------------: | :-------------------: | :---------------: | :----------------: |
|           Mask R-CNN                 |        Высокая        |     Медленная     |    Очень высокая   |
|          YOLOv11-seg                 |        Высокая        |   Очень высокая   |       Низкая       | 
|          Mask2Former                 |    State-of-the-art   |   Средняя/низкая  |  Умеренно высокая  |
|    Segment Anything Model (SAM)      |    State-of-the-art   |    Очень низкая   |    Очень высокая   | 

Исходя из таблице выше выбор пал на ``YOLOv11-seg``.

------------------------------------------------------

## Обучение модели
Для обучения была взята модель YOLOv11n-seg, где `n` - размер модели.

Обучение проходило на изображениях размером `640x640`, за один раз подавадлось 16 изображений (`batch = 16`) и количество эпох равно 250 (`epochs = 250`).

---------------------------------------------------

## Результаты обучения
Пример выполнения инстанс сегментации обученой модели:
|**Позвонки шейного отдела(С1-С7)**|**Позвонки грудного и поясничного отделов(T1-T12, L1-L5)**|
|:----------------------------------:|:-------------------------------------------------------:|
|![alt text](https://github.com/mansvlx/X-ray-spine-instance-segmentation/blob/main/data/result/0111122_png.rf.19859110a93dc0f021a332e1ff17fe56.jpg_result.jpg "Шейный отдел")|![alt text](https://github.com/mansvlx/X-ray-spine-instance-segmentation/blob/main/data/result/01-July-2019-83_jpg.rf.9f3e9abbe168061df8dc544b1646af54.jpg_result.jpg "Грудной и поясничный отделы")|

## Анализ метрик после обучения модели
### Предсказание(Precision)
| **BoxP** | **MaskP** |
|:---------:|:----------:|
|![alt text](https://github.com/mansvlx/X-ray-spine-instance-segmentation/blob/main/train%20result/BoxP_curve.png "BoxP curve") | ![alt text](https://github.com/mansvlx/X-ray-spine-instance-segmentation/blob/main/train%20result/BoxP_curve.png "BoxP curve") |
|Предсказание для прямоуголников по всем классам равно 1.00 при уверенности 0.943, однако, как видно из графика, некоторые классов при определённой уверености(`от 0.83 до 0.92`) будут предсказываться значительно хуже.| Предсказание для сегментации по всем классам равно 1.00 при уверенности 0.943, однако, как видно из графика, некоторые классов при определённой уверености(`от 0.83 до 0.92`) будут предсказываться значительно хуже.|

### Полнота(Recall)
| **BoxR** | **MaskR** |
|:---------:|:----------:|
|![alt text](https://github.com/mansvlx/X-ray-spine-instance-segmentation/blob/main/train%20result/BoxR_curve.png "BoxR curve") | ![alt text](https://github.com/mansvlx/X-ray-spine-instance-segmentation/blob/main/train%20result/MaskR_curve.png "MaskR curve") |
| Полнота для прямоугольников по всем классам равна 0.98 при уверенности 0.00, исследуя график дальше можно заметить, что с ростом уверености, падает полнота и при уверенности 1.00, полнота равна 0.00. Оптимальным значением данного графика будет являтся полнота = 0.7 и увренность = 0.7 | Полнота для сегментации по всем классам равна 0.97 при уверенности 0.00, исследуя график дальше можно заметить, что с ростом уверености, падает полнота и при уверенности 1.00, полнота равна 0.00. Оптимальным значением данного графика будет являтся полнота = 0.7 и увренность = 0.7|

### Компромисс предсказания и полноты(Precision-Recall)
| **BoxPR** | **MaskPR** |
|:---------:|:----------:|
|![alt text](https://github.com/mansvlx/X-ray-spine-instance-segmentation/blob/main/train%20result/BoxPR_curve.png "BoxPR curve") | ![alt text](https://github.com/mansvlx/X-ray-spine-instance-segmentation/blob/main/train%20result/MaskPR_curve.png "MaskPR curve")|


| **BoxF1** | **MaskF1** |
|:---------:|:----------:|
|![alt text](https://github.com/mansvlx/X-ray-spine-instance-segmentation/blob/main/train%20result/BoxF1_curve.png "BoxF1 curve") | ![alt text](https://github.com/mansvlx/X-ray-spine-instance-segmentation/blob/main/train%20result/MaskF1_curve.png "MaskF1 curve") |






